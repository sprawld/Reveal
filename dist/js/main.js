!function(){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,n=t._,e=Array.prototype,r=Object.prototype,i=e.push,o=e.slice,a=r.toString,u=r.hasOwnProperty,s=Array.isArray,c=Object.keys,l=Object.create,f=function(){},h=function(t){return t instanceof h?t:this instanceof h?void(this._wrapped=t):new h(t)};"undefined"==typeof exports||exports.nodeType?t._=h:("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=h),exports._=h),h.VERSION="1.8.3";var p=function(t,n,e){if(void 0===n)return t;switch(null==e?3:e){case 1:return function(e){return t.call(n,e)};case 3:return function(e,r,i){return t.call(n,e,r,i)};case 4:return function(e,r,i,o){return t.call(n,e,r,i,o)}}return function(){return t.apply(n,arguments)}},d=function(t,n,e){return null==t?h.identity:h.isFunction(t)?p(t,n,e):h.isObject(t)?h.matcher(t):h.property(t)};h.iteratee=function(t,n){return d(t,n,1/0)};var v=function(t,n){return n=null==n?t.length-1:+n,function(){for(var e=Math.max(arguments.length-n,0),r=Array(e),i=0;e>i;i++)r[i]=arguments[i+n];switch(n){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r);case 2:return t.call(this,arguments[0],arguments[1],r)}var o=Array(n+1);for(i=0;n>i;i++)o[i]=arguments[i];return o[n]=r,t.apply(this,o)}},g=function(t){if(!h.isObject(t))return{};if(l)return l(t);f.prototype=t;var n=new f;return f.prototype=null,n},m=function(t){return function(n){return null==n?void 0:n[t]}},y=Math.pow(2,53)-1,w=m("length"),b=function(t){var n=w(t);return"number"==typeof n&&n>=0&&y>=n};h.each=h.forEach=function(t,n,e){n=p(n,e);var r,i;if(b(t))for(r=0,i=t.length;i>r;r++)n(t[r],r,t);else{var o=h.keys(t);for(r=0,i=o.length;i>r;r++)n(t[o[r]],o[r],t)}return t},h.map=h.collect=function(t,n,e){n=d(n,e);for(var r=!b(t)&&h.keys(t),i=(r||t).length,o=Array(i),a=0;i>a;a++){var u=r?r[a]:a;o[a]=n(t[u],u,t)}return o};var j=function(t){var n=function(n,e,r,i){var o=!b(n)&&h.keys(n),a=(o||n).length,u=t>0?0:a-1;for(i||(r=n[o?o[u]:u],u+=t);u>=0&&a>u;u+=t){var s=o?o[u]:u;r=e(r,n[s],s,n)}return r};return function(t,e,r,i){var o=arguments.length>=3;return n(t,p(e,i,4),r,o)}};h.reduce=h.foldl=h.inject=j(1),h.reduceRight=h.foldr=j(-1),h.find=h.detect=function(t,n,e){var r;return r=b(t)?h.findIndex(t,n,e):h.findKey(t,n,e),void 0!==r&&-1!==r?t[r]:void 0},h.filter=h.select=function(t,n,e){var r=[];return n=d(n,e),h.each(t,function(t,e,i){n(t,e,i)&&r.push(t)}),r},h.reject=function(t,n,e){return h.filter(t,h.negate(d(n)),e)},h.every=h.all=function(t,n,e){n=d(n,e);for(var r=!b(t)&&h.keys(t),i=(r||t).length,o=0;i>o;o++){var a=r?r[o]:o;if(!n(t[a],a,t))return!1}return!0},h.some=h.any=function(t,n,e){n=d(n,e);for(var r=!b(t)&&h.keys(t),i=(r||t).length,o=0;i>o;o++){var a=r?r[o]:o;if(n(t[a],a,t))return!0}return!1},h.contains=h.includes=h.include=function(t,n,e,r){return b(t)||(t=h.values(t)),("number"!=typeof e||r)&&(e=0),h.indexOf(t,n,e)>=0},h.invoke=v(function(t,n,e){var r=h.isFunction(n);return h.map(t,function(t){var i=r?n:t[n];return null==i?i:i.apply(t,e)})}),h.pluck=function(t,n){return h.map(t,h.property(n))},h.where=function(t,n){return h.filter(t,h.matcher(n))},h.findWhere=function(t,n){return h.find(t,h.matcher(n))},h.max=function(t,n,e){var r,i,o=-(1/0),a=-(1/0);if(null==n||"number"==typeof n&&"object"!=typeof t[0]&&null!=t){t=b(t)?t:h.values(t);for(var u=0,s=t.length;s>u;u++)r=t[u],null!=r&&r>o&&(o=r)}else n=d(n,e),h.each(t,function(t,e,r){i=n(t,e,r),(i>a||i===-(1/0)&&o===-(1/0))&&(o=t,a=i)});return o},h.min=function(t,n,e){var r,i,o=1/0,a=1/0;if(null==n||"number"==typeof n&&"object"!=typeof t[0]&&null!=t){t=b(t)?t:h.values(t);for(var u=0,s=t.length;s>u;u++)r=t[u],null!=r&&o>r&&(o=r)}else n=d(n,e),h.each(t,function(t,e,r){i=n(t,e,r),(a>i||i===1/0&&o===1/0)&&(o=t,a=i)});return o},h.shuffle=function(t){return h.sample(t,1/0)},h.sample=function(t,n,e){if(null==n||e)return b(t)||(t=h.values(t)),t[h.random(t.length-1)];var r=b(t)?h.clone(t):h.values(t),i=w(r);n=Math.max(Math.min(n,i),0);for(var o=i-1,a=0;n>a;a++){var u=h.random(a,o),s=r[a];r[a]=r[u],r[u]=s}return r.slice(0,n)},h.sortBy=function(t,n,e){var r=0;return n=d(n,e),h.pluck(h.map(t,function(t,e,i){return{value:t,index:r++,criteria:n(t,e,i)}}).sort(function(t,n){var e=t.criteria,r=n.criteria;if(e!==r){if(e>r||void 0===e)return 1;if(r>e||void 0===r)return-1}return t.index-n.index}),"value")};var x=function(t,n){return function(e,r,i){var o=n?[[],[]]:{};return r=d(r,i),h.each(e,function(n,i){var a=r(n,i,e);t(o,n,a)}),o}};h.groupBy=x(function(t,n,e){h.has(t,e)?t[e].push(n):t[e]=[n]}),h.indexBy=x(function(t,n,e){t[e]=n}),h.countBy=x(function(t,n,e){h.has(t,e)?t[e]++:t[e]=1});var E=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;h.toArray=function(t){return t?h.isArray(t)?o.call(t):h.isString(t)?t?t.match(E):[]:b(t)?h.map(t,h.identity):h.values(t):[]},h.size=function(t){return null==t?0:b(t)?t.length:h.keys(t).length},h.partition=x(function(t,n,e){t[e?0:1].push(n)},!0),h.first=h.head=h.take=function(t,n,e){return null==t?void 0:null==n||e?t[0]:h.initial(t,t.length-n)},h.initial=function(t,n,e){return o.call(t,0,Math.max(0,t.length-(null==n||e?1:n)))},h.last=function(t,n,e){return null==t?void 0:null==n||e?t[t.length-1]:h.rest(t,Math.max(0,t.length-n))},h.rest=h.tail=h.drop=function(t,n,e){return o.call(t,null==n||e?1:n)},h.compact=function(t){return h.filter(t,h.identity)};var _=function(t,n,e,r){r=r||[];for(var i=r.length,o=0,a=w(t);a>o;o++){var u=t[o];if(b(u)&&(h.isArray(u)||h.isArguments(u)))if(n)for(var s=0,c=u.length;c>s;)r[i++]=u[s++];else _(u,n,e,r),i=r.length;else e||(r[i++]=u)}return r};h.flatten=function(t,n){return _(t,n,!1)},h.without=v(function(t,n){return h.difference(t,n)}),h.uniq=h.unique=function(t,n,e,r){h.isBoolean(n)||(r=e,e=n,n=!1),null!=e&&(e=d(e,r));for(var i=[],o=[],a=0,u=w(t);u>a;a++){var s=t[a],c=e?e(s,a,t):s;n?(a&&o===c||i.push(s),o=c):e?h.contains(o,c)||(o.push(c),i.push(s)):h.contains(i,s)||i.push(s)}return i},h.union=v(function(t){return h.uniq(_(t,!0,!0))}),h.intersection=function(t){for(var n=[],e=arguments.length,r=0,i=w(t);i>r;r++){var o=t[r];if(!h.contains(n,o)){var a;for(a=1;e>a&&h.contains(arguments[a],o);a++);a===e&&n.push(o)}}return n},h.difference=v(function(t,n){return n=_(n,!0,!0),h.filter(t,function(t){return!h.contains(n,t)})}),h.unzip=function(t){for(var n=t&&h.max(t,w).length||0,e=Array(n),r=0;n>r;r++)e[r]=h.pluck(t,r);return e},h.zip=v(h.unzip),h.object=function(t,n){for(var e={},r=0,i=w(t);i>r;r++)n?e[t[r]]=n[r]:e[t[r][0]]=t[r][1];return e};var A=function(t){return function(n,e,r){e=d(e,r);for(var i=w(n),o=t>0?0:i-1;o>=0&&i>o;o+=t)if(e(n[o],o,n))return o;return-1}};h.findIndex=A(1),h.findLastIndex=A(-1),h.sortedIndex=function(t,n,e,r){e=d(e,r,1);for(var i=e(n),o=0,a=w(t);a>o;){var u=Math.floor((o+a)/2);e(t[u])<i?o=u+1:a=u}return o};var O=function(t,n,e){return function(r,i,a){var u=0,s=w(r);if("number"==typeof a)t>0?u=a>=0?a:Math.max(a+s,u):s=a>=0?Math.min(a+1,s):a+s+1;else if(e&&a&&s)return a=e(r,i),r[a]===i?a:-1;if(i!==i)return a=n(o.call(r,u,s),h.isNaN),a>=0?a+u:-1;for(a=t>0?u:s-1;a>=0&&s>a;a+=t)if(r[a]===i)return a;return-1}};h.indexOf=O(1,h.findIndex,h.sortedIndex),h.lastIndexOf=O(-1,h.findLastIndex),h.range=function(t,n,e){null==n&&(n=t||0,t=0),e=e||1;for(var r=Math.max(Math.ceil((n-t)/e),0),i=Array(r),o=0;r>o;o++,t+=e)i[o]=t;return i},h.chunk=function(t,n){if(null==n||1>n)return[];for(var e=[],r=0,i=t.length;i>r;)e.push(o.call(t,r,r+=n));return e};var k=function(t,n,e,r,i){if(!(r instanceof n))return t.apply(e,i);var o=g(t.prototype),a=t.apply(o,i);return h.isObject(a)?a:o};h.bind=v(function(t,n,e){if(!h.isFunction(t))throw new TypeError("Bind must be called on a function");var r=v(function(i){return k(t,r,n,this,e.concat(i))});return r}),h.partial=v(function(t,n){var e=h.partial.placeholder,r=function(){for(var i=0,o=n.length,a=Array(o),u=0;o>u;u++)a[u]=n[u]===e?arguments[i++]:n[u];for(;i<arguments.length;)a.push(arguments[i++]);return k(t,r,this,this,a)};return r}),h.partial.placeholder=h,h.bindAll=v(function(t,n){n=_(n,!1,!1);var e=n.length;if(1>e)throw new Error("bindAll must be passed function names");for(;e--;){var r=n[e];t[r]=h.bind(t[r],t)}}),h.memoize=function(t,n){var e=function(r){var i=e.cache,o=""+(n?n.apply(this,arguments):r);return h.has(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return e.cache={},e},h.delay=v(function(t,n,e){return setTimeout(function(){return t.apply(null,e)},n)}),h.defer=h.partial(h.delay,h,1),h.throttle=function(t,n,e){var r,i,o,a=null,u=0;e||(e={});var s=function(){u=e.leading===!1?0:h.now(),a=null,o=t.apply(r,i),a||(r=i=null)};return function(){var c=h.now();u||e.leading!==!1||(u=c);var l=n-(c-u);return r=this,i=arguments,0>=l||l>n?(a&&(clearTimeout(a),a=null),u=c,o=t.apply(r,i),a||(r=i=null)):a||e.trailing===!1||(a=setTimeout(s,l)),o}},h.debounce=function(t,n,e){var r,i,o,a,u,s=function(){var c=h.now()-a;n>c&&c>=0?r=setTimeout(s,n-c):(r=null,e||(u=t.apply(o,i),r||(o=i=null)))};return function(){o=this,i=arguments,a=h.now();var c=e&&!r;return r||(r=setTimeout(s,n)),c&&(u=t.apply(o,i),o=i=null),u}},h.wrap=function(t,n){return h.partial(n,t)},h.negate=function(t){return function(){return!t.apply(this,arguments)}},h.compose=function(){var t=arguments,n=t.length-1;return function(){for(var e=n,r=t[n].apply(this,arguments);e--;)r=t[e].call(this,r);return r}},h.after=function(t,n){return function(){return--t<1?n.apply(this,arguments):void 0}},h.before=function(t,n){var e;return function(){return--t>0&&(e=n.apply(this,arguments)),1>=t&&(n=null),e}},h.once=h.partial(h.before,2),h.restArgs=v;var L=!{toString:null}.propertyIsEnumerable("toString"),$=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],I=function(t,n){var e=$.length,i=t.constructor,o=h.isFunction(i)&&i.prototype||r,a="constructor";for(h.has(t,a)&&!h.contains(n,a)&&n.push(a);e--;)a=$[e],a in t&&t[a]!==o[a]&&!h.contains(n,a)&&n.push(a)};h.keys=function(t){if(!h.isObject(t))return[];if(c)return c(t);var n=[];for(var e in t)h.has(t,e)&&n.push(e);return L&&I(t,n),n},h.allKeys=function(t){if(!h.isObject(t))return[];var n=[];for(var e in t)n.push(e);return L&&I(t,n),n},h.values=function(t){for(var n=h.keys(t),e=n.length,r=Array(e),i=0;e>i;i++)r[i]=t[n[i]];return r},h.mapObject=function(t,n,e){n=d(n,e);for(var r=h.keys(t),i=r.length,o={},a=0;i>a;a++){var u=r[a];o[u]=n(t[u],u,t)}return o},h.pairs=function(t){for(var n=h.keys(t),e=n.length,r=Array(e),i=0;e>i;i++)r[i]=[n[i],t[n[i]]];return r},h.invert=function(t){for(var n={},e=h.keys(t),r=0,i=e.length;i>r;r++)n[t[e[r]]]=e[r];return n},h.functions=h.methods=function(t){var n=[];for(var e in t)h.isFunction(t[e])&&n.push(e);return n.sort()};var q=function(t,n){return function(e){var r=arguments.length;if(n&&(e=Object(e)),2>r||null==e)return e;for(var i=1;r>i;i++)for(var o=arguments[i],a=t(o),u=a.length,s=0;u>s;s++){var c=a[s];n&&void 0!==e[c]||(e[c]=o[c])}return e}};h.extend=q(h.allKeys),h.extendOwn=h.assign=q(h.keys),h.findKey=function(t,n,e){n=d(n,e);for(var r,i=h.keys(t),o=0,a=i.length;a>o;o++)if(r=i[o],n(t[r],r,t))return r};var C=function(t,n,e){return n in e};h.pick=v(function(t,n){var e={},r=n[0];if(null==t)return e;h.isFunction(r)?(n.length>1&&(r=p(r,n[1])),n=h.allKeys(t)):(r=C,n=_(n,!1,!1),t=Object(t));for(var i=0,o=n.length;o>i;i++){var a=n[i],u=t[a];r(u,a,t)&&(e[a]=u)}return e}),h.omit=v(function(t,n){var e,r=n[0];return h.isFunction(r)?(r=h.negate(r),n.length>1&&(e=n[1])):(n=h.map(_(n,!1,!1),String),r=function(t,e){return!h.contains(n,e)}),h.pick(t,r,e)}),h.defaults=q(h.allKeys,!0),h.create=function(t,n){var e=g(t);return n&&h.extendOwn(e,n),e},h.clone=function(t){return h.isObject(t)?h.isArray(t)?t.slice():h.extend({},t):t},h.tap=function(t,n){return n(t),t},h.isMatch=function(t,n){var e=h.keys(n),r=e.length;if(null==t)return!r;for(var i=Object(t),o=0;r>o;o++){var a=e[o];if(n[a]!==i[a]||!(a in i))return!1}return!0};var M,S;M=function(t,n,e,r){if(t===n)return 0!==t||1/t===1/n;if(null==t||null==n)return t===n;if(t!==t)return n!==n;var i=typeof t;return"function"!==i&&"object"!==i&&"object"!=typeof n?!1:S(t,n,e,r)},S=function(t,n,e,r){t instanceof h&&(t=t._wrapped),n instanceof h&&(n=n._wrapped);var i=a.call(t);if(i!==a.call(n))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+n;case"[object Number]":return+t!==+t?+n!==+n:0===+t?1/+t===1/n:+t===+n;case"[object Date]":case"[object Boolean]":return+t===+n}var o="[object Array]"===i;if(!o){if("object"!=typeof t||"object"!=typeof n)return!1;var u=t.constructor,s=n.constructor;if(u!==s&&!(h.isFunction(u)&&u instanceof u&&h.isFunction(s)&&s instanceof s)&&"constructor"in t&&"constructor"in n)return!1}e=e||[],r=r||[];for(var c=e.length;c--;)if(e[c]===t)return r[c]===n;if(e.push(t),r.push(n),o){if(c=t.length,c!==n.length)return!1;for(;c--;)if(!M(t[c],n[c],e,r))return!1}else{var l,f=h.keys(t);if(c=f.length,h.keys(n).length!==c)return!1;for(;c--;)if(l=f[c],!h.has(n,l)||!M(t[l],n[l],e,r))return!1}return e.pop(),r.pop(),!0},h.isEqual=function(t,n){return M(t,n)},h.isEmpty=function(t){return null==t?!0:b(t)&&(h.isArray(t)||h.isString(t)||h.isArguments(t))?0===t.length:0===h.keys(t).length},h.isElement=function(t){return!(!t||1!==t.nodeType)},h.isArray=s||function(t){return"[object Array]"===a.call(t)},h.isObject=function(t){var n=typeof t;return"function"===n||"object"===n&&!!t},h.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){h["is"+t]=function(n){return a.call(n)==="[object "+t+"]"}}),h.isArguments(arguments)||(h.isArguments=function(t){return h.has(t,"callee")});var T=t.document&&t.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof T&&(h.isFunction=function(t){return"function"==typeof t||!1}),h.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},h.isNaN=function(t){return h.isNumber(t)&&isNaN(t)},h.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===a.call(t)},h.isNull=function(t){return null===t},h.isUndefined=function(t){return void 0===t},h.has=function(t,n){return null!=t&&u.call(t,n)},h.noConflict=function(){return t._=n,this},h.identity=function(t){return t},h.constant=function(t){return function(){return t}},h.noop=function(){},h.property=m,h.propertyOf=function(t){return null==t?function(){}:function(n){return t[n]}},h.matcher=h.matches=function(t){return t=h.extendOwn({},t),function(n){return h.isMatch(n,t)}},h.times=function(t,n,e){var r=Array(Math.max(0,t));n=p(n,e,1);for(var i=0;t>i;i++)r[i]=n(i);return r},h.random=function(t,n){return null==n&&(n=t,t=0),t+Math.floor(Math.random()*(n-t+1))},h.now=Date.now||function(){return(new Date).getTime()};var F={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=h.invert(F),B=function(t){var n=function(n){return t[n]},e="(?:"+h.keys(t).join("|")+")",r=RegExp(e),i=RegExp(e,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,n):t}};h.escape=B(F),h.unescape=B(N),h.result=function(t,n,e){var r=null==t?void 0:t[n];return void 0===r&&(r=e),h.isFunction(r)?r.call(t):r};var R=0;h.uniqueId=function(t){var n=++R+"";return t?t+n:n},h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,D={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\u2028|\u2029/g,V=function(t){return"\\"+D[t]};h.template=function(t,n,e){!n&&e&&(n=e),n=h.defaults({},n,h.templateSettings);var r=RegExp([(n.escape||z).source,(n.interpolate||z).source,(n.evaluate||z).source].join("|")+"|$","g"),i=0,o="__p+='";t.replace(r,function(n,e,r,a,u){return o+=t.slice(i,u).replace(P,V),i=u+n.length,e?o+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":a&&(o+="';\n"+a+"\n__p+='"),n}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";var a;try{a=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}var s=function(t){return a.call(this,t,h)},c=n.variable||"obj";return s.source="function("+c+"){\n"+o+"}",s},h.chain=function(t){var n=h(t);return n._chain=!0,n};var K=function(t,n){return t._chain?h(n).chain():n};h.mixin=function(t){h.each(h.functions(t),function(n){var e=h[n]=t[n];h.prototype[n]=function(){var t=[this._wrapped];return i.apply(t,arguments),K(this,e.apply(h,t))}})},h.mixin(h),h.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var n=e[t];h.prototype[t]=function(){var e=this._wrapped;return n.apply(e,arguments),"shift"!==t&&"splice"!==t||0!==e.length||delete e[0],K(this,e)}}),h.each(["concat","join","slice"],function(t){var n=e[t];h.prototype[t]=function(){return K(this,n.apply(this._wrapped,arguments))}}),h.prototype.value=function(){return this._wrapped},h.prototype.valueOf=h.prototype.toJSON=h.prototype.value,h.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return h})}(),function(){function t(){}function n(t,n){for(var e=t.length;e--;)if(t[e].listener===n)return e;return-1}function e(t){return function(){return this[t].apply(this,arguments)}}var r=t.prototype,i=this,o=i.EventEmitter;r.getListeners=function(t){var n,e,r=this._getEvents();if("object"==typeof t){n={};for(e in r)r.hasOwnProperty(e)&&t.test(e)&&(n[e]=r[e])}else n=r[t]||(r[t]=[]);return n},r.flattenListeners=function(t){var n,e=[];for(n=0;t.length>n;n+=1)e.push(t[n].listener);return e},r.getListenersAsObject=function(t){var n,e=this.getListeners(t);return e instanceof Array&&(n={},n[t]=e),n||e},r.addListener=function(t,e){var r,i=this.getListenersAsObject(t),o="object"==typeof e;for(r in i)i.hasOwnProperty(r)&&-1===n(i[r],e)&&i[r].push(o?e:{listener:e,once:!1});return this},r.on=e("addListener"),r.addOnceListener=function(t,n){return this.addListener(t,{listener:n,once:!0})},r.once=e("addOnceListener"),r.defineEvent=function(t){return this.getListeners(t),this},r.defineEvents=function(t){for(var n=0;t.length>n;n+=1)this.defineEvent(t[n]);return this},r.removeListener=function(t,e){var r,i,o=this.getListenersAsObject(t);for(i in o)o.hasOwnProperty(i)&&(r=n(o[i],e),-1!==r&&o[i].splice(r,1));return this},r.off=e("removeListener"),r.addListeners=function(t,n){return this.manipulateListeners(!1,t,n)},r.removeListeners=function(t,n){return this.manipulateListeners(!0,t,n)},r.manipulateListeners=function(t,n,e){var r,i,o=t?this.removeListener:this.addListener,a=t?this.removeListeners:this.addListeners;if("object"!=typeof n||n instanceof RegExp)for(r=e.length;r--;)o.call(this,n,e[r]);else for(r in n)n.hasOwnProperty(r)&&(i=n[r])&&("function"==typeof i?o.call(this,r,i):a.call(this,r,i));return this},r.removeEvent=function(t){var n,e=typeof t,r=this._getEvents();if("string"===e)delete r[t];else if("object"===e)for(n in r)r.hasOwnProperty(n)&&t.test(n)&&delete r[n];else delete this._events;return this},r.removeAllListeners=e("removeEvent"),r.emitEvent=function(t,n){var e,r,i,o,a=this.getListenersAsObject(t);for(i in a)if(a.hasOwnProperty(i))for(r=a[i].length;r--;)e=a[i][r],e.once===!0&&this.removeListener(t,e.listener),o=e.listener.apply(this,n||[]),o===this._getOnceReturnValue()&&this.removeListener(t,e.listener);return this},r.trigger=e("emitEvent"),r.emit=function(t){var n=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,n)},r.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return i.EventEmitter=o,t},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return t}):"object"==typeof module&&module.exports?module.exports=t:this.EventEmitter=t}.call(this),function(t){function n(n){var e=t.event;return e.target=e.target||e.srcElement||n,e}var e=document.documentElement,r=function(){};e.addEventListener?r=function(t,n,e){t.addEventListener(n,e,!1)}:e.attachEvent&&(r=function(t,e,r){t[e+r]=r.handleEvent?function(){var e=n(t);r.handleEvent.call(r,e)}:function(){var e=n(t);r.call(t,e)},t.attachEvent("on"+e,t[e+r])});var i=function(){};e.removeEventListener?i=function(t,n,e){t.removeEventListener(n,e,!1)}:e.detachEvent&&(i=function(t,n,e){t.detachEvent("on"+n,t[n+e]);try{delete t[n+e]}catch(r){t[n+e]=void 0}});var o={bind:r,unbind:i};"function"==typeof define&&define.amd?define("eventie/eventie",o):t.eventie=o}(this),function(t,n){"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(e,r){return n(t,e,r)}):"object"==typeof exports?module.exports=n(t,require("wolfy87-eventemitter"),require("eventie")):t.imagesLoaded=n(t,t.EventEmitter,t.eventie)}(window,function(t,n,e){function r(t,n){for(var e in n)t[e]=n[e];return t}function i(t){return"[object Array]"===h.call(t)}function o(t){var n=[];if(i(t))n=t;else if("number"==typeof t.length)for(var e=0,r=t.length;r>e;e++)n.push(t[e]);else n.push(t);return n}function a(t,n,e){if(!(this instanceof a))return new a(t,n);"string"==typeof t&&(t=document.querySelectorAll(t)),this.elements=o(t),this.options=r({},this.options),"function"==typeof n?e=n:r(this.options,n),e&&this.on("always",e),this.getImages(),c&&(this.jqDeferred=new c.Deferred);var i=this;setTimeout(function(){i.check()})}function u(t){this.img=t}function s(t){this.src=t,p[t]=this}var c=t.jQuery,l=t.console,f=void 0!==l,h=Object.prototype.toString;a.prototype=new n,a.prototype.options={},a.prototype.getImages=function(){this.images=[];for(var t=0,n=this.elements.length;n>t;t++){var e=this.elements[t];"IMG"===e.nodeName&&this.addImage(e);var r=e.nodeType;if(r&&(1===r||9===r||11===r))for(var i=e.querySelectorAll("img"),o=0,a=i.length;a>o;o++){var u=i[o];this.addImage(u)}}},a.prototype.addImage=function(t){var n=new u(t);this.images.push(n)},a.prototype.check=function(){function t(t,i){return n.options.debug&&f&&l.log("confirm",t,i),n.progress(t),e++,e===r&&n.complete(),!0}var n=this,e=0,r=this.images.length;if(this.hasAnyBroken=!1,!r)return void this.complete();for(var i=0;r>i;i++){var o=this.images[i];o.on("confirm",t),o.check()}},a.prototype.progress=function(t){this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded;var n=this;setTimeout(function(){n.emit("progress",n,t),n.jqDeferred&&n.jqDeferred.notify&&n.jqDeferred.notify(n,t)})},a.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var n=this;setTimeout(function(){if(n.emit(t,n),n.emit("always",n),n.jqDeferred){var e=n.hasAnyBroken?"reject":"resolve";n.jqDeferred[e](n)}})},c&&(c.fn.imagesLoaded=function(t,n){var e=new a(this,t,n);return e.jqDeferred.promise(c(this))}),u.prototype=new n,u.prototype.check=function(){var t=p[this.img.src]||new s(this.img.src);if(t.isConfirmed)return void this.confirm(t.isLoaded,"cached was confirmed");if(this.img.complete&&void 0!==this.img.naturalWidth)return void this.confirm(0!==this.img.naturalWidth,"naturalWidth");var n=this;t.on("confirm",function(t,e){return n.confirm(t.isLoaded,e),!0}),t.check()},u.prototype.confirm=function(t,n){this.isLoaded=t,this.emit("confirm",this,n)};var p={};return s.prototype=new n,s.prototype.check=function(){if(!this.isChecked){var t=new Image;e.bind(t,"load",this),e.bind(t,"error",this),t.src=this.src,this.isChecked=!0}},s.prototype.handleEvent=function(t){var n="on"+t.type;this[n]&&this[n](t)},s.prototype.onload=function(t){this.confirm(!0,"onload"),this.unbindProxyEvents(t)},s.prototype.onerror=function(t){this.confirm(!1,"onerror"),this.unbindProxyEvents(t)},s.prototype.confirm=function(t,n){this.isConfirmed=!0,this.isLoaded=t,this.emit("confirm",this,n)},s.prototype.unbindProxyEvents=function(t){e.unbind(t.target,"load",this),e.unbind(t.target,"error",this)},a}),$(function(){"use strict";function t(t,n,e){var r=s.obj.eq(t),i=r.data("gallery"),o=i.grid[0],a=i.grid[1],c=u(o,a,n),l=s.time.img.all/(o*a),f="left"==n?"25%":"right"==n?"75%":"50%";r.find("img").each(function(t){$(this).removeClass("display").velocity({opacity:0,"max-width":"50%","max-height":"50%",left:f},{duration:s.time.img.each,easing:[.4,0,.2,1],delay:parseInt(c[t]*l),complete:function(t){$(t).parent().removeClass("display").hide()}})}),e&&$.isFunction(e)&&setTimeout(e,s.time.img.each+s.time.img.all)}function n(t){for(var n=1,e=t,r=Math.min(s.width/t,s.height),i=2;t>=i;i++){var o=parseInt(t/i)+(t%i==0?0:1),a=Math.min(s.width/o,s.height/i);a>r&&(r=a,n=i,e=o)}return[e,n]}function e(t){for(var e=s.obj.eq(t),r=e.find("a"),i=r.length,o=(s.width/i,n(i)),a=o[1],u=o[0],c=s.width/u,l=s.height/a,f=100,h=0;h<s.sizes.length&&!(c<s.sizes[h]&&l<s.sizes);h++)f=s.sizes[h];e.data("gallery",{grid:o,size:f})}function r(t){var n=s.obj.eq(t),e=n.find("a"),r=n.data("gallery"),i=r.size;e.each(function(){var t=$(this).attr("href").replace(/^img\//,"");$(this).html('<img src="img/'+i+"/"+t+'">')})}function i(t,n){var i=s.obj.eq(t);i.hasClass("loaded")?console.log(t+" has already been preloaded"):s.preload=setTimeout(function(){console.log("preloading "+t),e(t),r(t),i.imagesLoaded().always(function(){console.log(t+" preloaded"),i.addClass("loaded")})},s.time.preload)}function o(t,n){var e=s.obj.eq(t),r=s.title;s.title=e.find("h2");var i=r.width(),o="right"==n?s.width:-i;r.velocity({left:o+"px"},{duration:s.time.title.leave,easing:[.4,0,1,1],complete:function(t){$(t).removeClass("display")}});var a=s.title.width(),u=(s.width-a)/2-2,c="right"==n?-a:s.width;console.log("galleryMiddle "+a+" : "+s.width+" = "+u),s.title.addClass("display").css({top:0,left:c+"px",width:a+4+"px",opacity:1}).show().velocity({left:u+"px"},{duration:s.time.title.leave,delay:s.time.title.gap,easing:[0,0,.2,1],complete:function(t){}})}function a(t,n){var o=s.obj.eq(t);o.hasClass("loaded")?console.log(t+" already loaded"):(s.preload&&clearTimeout(s.preload),console.log("loading "+t),e(t),r(t));var a=o.find("a"),c=o.data("gallery"),l=c.grid[0],f=c.grid[1],h=u(l,f,n),p=s.time.img.all/(l*f),d=100/l,v=1e4/s.height,g=(100-v)/f,m="left"==n?"75%":"right"==n?"25%":"50%";o.imagesLoaded().progress(function(){}).always(function(){o.addClass("loaded"),a.each(function(t){var n=t%l,e=parseInt(t/l),r=n*d,i=v+e*g;$(this).addClass("display").show().css({top:i+"%",left:r+"%",width:d+"%",height:g+"%"});var o=$(this).find("img");o.css({opacity:0,"max-width":"50%","max-height":"50%",left:m}).show().velocity({opacity:1,"max-width":"90%","max-height":"90%",left:"50%"},{duration:s.time.img.each,easing:[.4,0,.2,1],delay:parseInt(h[t]*p)})}),t<s.length-1&&i(t+1,0)})}function u(t,n,e){for(var r=new Array(t*n),i=0,o=0;t>o;o++)for(var a=n>o+1?o+1:n,u=0;a>u;u++){var s=o-u,c=u,l="right"==e?c*t+s:c*t+(t-s-1);r[l]=i++}for(var o=1;n>o;o++)for(var a=n-o>t?t:n-o,u=0;a>u;u++){var s=t-1-u,c=o+u,l="right"==e?c*t+s:c*t+(t-s-1);r[l]=i++}return r}var s={obj:$("section"),length:$("section").length,title:$("#title"),pos:0,menu:!0,width:window.innerWidth,height:window.innerHeight-100,sizes:[100,200,300,400,500],preload:null,time:{img:{gap:500,each:300,all:300},title:{gap:300,leave:500,enter:500},preload:1e3}};$("a").on("click",function(t){t.preventDefault()}),$("section").each(function(t){var n=$(this).find("h2").height();$(this).css({height:n+"px"}).data("num",t)}),$("section h2").on("click",function(){if($(this).hasClass("display")){var n=$(this),e=n.parent(),r=e.data("num");$("#pics").removeClass("ondisplay");var i=e.offset(),o=i.top,u=window.innerHeight,c=0;o>u/2&&(c=o-u/2,o=u/2),n.velocity({top:o+"px"},{duration:500,easing:[.4,0,.2,1],complete:function(t){}}),t(r,"straight",function(){$(window).scrollTop(c),$("section h2:not(.display)").velocity({opacity:1},500),n.removeClass("display")})}else{var i=$(this).offset(),c=$(window).scrollTop(),l=$(window).scrollLeft(),o=i.top-c+"px",f=i.left-l+"px";s.title=$(this);var h=s.title.width(),p=(s.width-h)/2-2;console.log("galleryMiddle "+h+" : "+s.width+" = "+p);var r=$(this).parent().data("num");s.title.addClass("display").css({top:o,left:f,width:h+4+"px"}).velocity({top:0},{duration:s.time.title.enter,easing:[.4,0,.2,1],complete:function(t){a(r,"straight"),s.pos=r,$("#pics").addClass("ondisplay")}}),$("section h2:not(.display)").velocity({opacity:0},500)}}),$(window).on("resize",_.debounce(function(){$("section.loaded").removeClass("loaded"),s.width=window.innerWidth,s.height=window.innerHeight-100},500)),$("#next").on("click",_.debounce(function(){t(s.pos,"left"),s.pos++,s.pos>=s.length&&(s.pos=0),o(s.pos,"left"),setTimeout(function(){a(s.pos,"left")},s.time.img.gap)},500,!0)),$("#prev").on("click",_.debounce(function(){t(s.pos,"right"),s.pos--,s.pos<0&&(s.pos=s.length-1),o(s.pos,"right"),setTimeout(function(){a(s.pos,"right")},s.time.img.gap)},500,!0))});